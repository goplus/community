// Code generated by gop (Go+); DO NOT EDIT.

package main

import (
	"context"
	"flag"
	"fmt"
	"github.com/gabriel-vasile/mimetype"
	"github.com/goplus/community/internal/core"
	"github.com/goplus/community/translation"
	"github.com/goplus/yap"
	"github.com/joho/godotenv"
	_ "github.com/joho/godotenv/autoload"
	"github.com/liuscraft/gop-casdoor-account-sdk"
	"github.com/qiniu/x/xlog"
	"golang.org/x/text/language"
	"io"
	"net/http"
	"net/url"
	"os"
	"regexp"
	"strconv"
	"strings"
)

const _ = true
const (
	limitConst = 10
	labelConst = "article"
)
const (
	mediaLimitConst = 8
	firstConst      = "1"
)

type delete_api_article_id struct {
	yap.Handler
	*AppV2
}
type delete_api_media_id struct {
	yap.Handler
	*AppV2
}
type get struct {
	yap.Handler
	*AppV2
}
type get_add struct {
	yap.Handler
	*AppV2
	community *core.Community
	user      *core.User
}
type get_api_article_id struct {
	yap.Handler
	*AppV2
}
type get_api_articles struct {
	yap.Handler
	*AppV2
}
type get_api_media_id_url struct {
	yap.Handler
	*AppV2
}
type get_api_translation_id struct {
	yap.Handler
	*AppV2
}
type get_api_user_acoount_unlink struct {
	yap.Handler
	*AppV2
}
type get_api_user_articles_id struct {
	yap.Handler
	*AppV2
}
type get_api_user_get_qrcode struct {
	yap.Handler
	*AppV2
}
type get_api_user_medias_id struct {
	yap.Handler
	*AppV2
}
type get_api_users struct {
	yap.Handler
	*AppV2
	user *core.User
}
type get_api_video_id struct {
	yap.Handler
	*AppV2
}
type get_article_id struct {
	yap.Handler
	*AppV2
	user *core.User
}
type get_edit_id struct {
	yap.Handler
	*AppV2
	user *core.User
}
type get_error struct {
	yap.Handler
	*AppV2
	user *core.User
}
type get_failed struct {
	yap.Handler
	*AppV2
	user *core.User
}
type get_login struct {
	yap.Handler
	*AppV2
}
type get_login_callback struct {
	yap.Handler
	*AppV2
}
type get_logout struct {
	yap.Handler
	*AppV2
}
type get_search struct {
	yap.Handler
	*AppV2
	user *core.User
}
type get_success struct {
	yap.Handler
	*AppV2
}
type get_user_edit struct {
	yap.Handler
	*AppV2
	user *core.User
}
type get_user_info_id struct {
	yap.Handler
	*AppV2
	user *core.User
}
type handle struct {
	yap.Handler
	*AppV2
}
type AppV2 struct {
	yap.AppV2
	community *core.Community
	domain    string
}
type post_api_article_commit struct {
	yap.Handler
	*AppV2
	trans *translation.Engine
}
type post_api_article_like struct {
	yap.Handler
	*AppV2
}
type post_api_caption_task struct {
	yap.Handler
	*AppV2
}
type post_api_media struct {
	yap.Handler
	*AppV2
}
type post_api_translation struct {
	yap.Handler
	*AppV2
}
type put_api_user struct {
	yap.Handler
	*AppV2
}
type put_api_user_public struct {
	yap.Handler
	*AppV2
	user *core.User
}

//line cmd/v2community/main.yap:16
func (this *AppV2) MainEntry() {
//line cmd/v2community/main.yap:16:1
	xLog := xlog.New("")
//line cmd/v2community/main.yap:17:1
	todo := context.TODO()
//line cmd/v2community/main.yap:18:1
	this.Static__0("/static")
//line cmd/v2community/main.yap:19:1
	configFile := ".env"
//line cmd/v2community/main.yap:20:1
	flag.StringVar(&configFile, "config", ".env", "Path to the config file")
//line cmd/v2community/main.yap:21:1
	flag.Parse()
//line cmd/v2community/main.yap:22:1
	if
//line cmd/v2community/main.yap:22:1
	err := godotenv.Load(configFile); err != nil {
//line cmd/v2community/main.yap:23:1
		xLog.Error(err)
	}
//line cmd/v2community/main.yap:26:1
	conf := core.NewConfigFromEnv()
//line cmd/v2community/main.yap:27:1
	this.community, _ = core.New(todo, conf)
//line cmd/v2community/main.yap:28:1
	this.domain = conf.QiNiuConfig.Domain
//line cmd/v2community/main.yap:29:1
	endpoint := conf.AppConfig.EndPoint
//line cmd/v2community/main.yap:31:1
	xLog.Info("Started in endpoint: ", endpoint)
//line cmd/v2community/main.yap:34:1
	this.Run(endpoint, func(h http.Handler) http.Handler {
//line cmd/v2community/main.yap:36:1
		return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {
//line cmd/v2community/main.yap:37:1
			defer func() {
//line cmd/v2community/main.yap:39:1
				if
//line cmd/v2community/main.yap:39:1
				err := recover(); err != nil {
//line cmd/v2community/main.yap:40:1
					xLog.Error(err)
//line cmd/v2community/main.yap:41:1
					http.Redirect(w, r, "/failed", http.StatusFound)
				}
			}()
//line cmd/v2community/main.yap:45:1
			h.ServeHTTP(w, r)
		})
	})
}
func (this *AppV2) Main() {
	yap.Gopt_AppV2_Main(this, new(delete_api_article_id), new(delete_api_media_id), new(get), new(get_add), new(get_api_article_id), new(get_api_articles), new(get_api_media_id_url), new(get_api_translation_id), new(get_api_user_acoount_unlink), new(get_api_user_articles_id), new(get_api_user_get_qrcode), new(get_api_user_medias_id), new(get_api_users), new(get_api_video_id), new(get_article_id), new(get_edit_id), new(get_error), new(get_failed), new(get_login), new(get_login_callback), new(get_logout), new(get_search), new(get_success), new(get_user_edit), new(get_user_info_id), new(handle), new(post_api_article_commit), new(post_api_article_like), new(post_api_caption_task), new(post_api_media), new(post_api_translation), new(put_api_user), new(put_api_user_public))
}

//line cmd/v2community/delete_api_article_#id.yap:7
func (this *delete_api_article_id) Main(_gop_arg0 *yap.Context) {
	this.Handler.Main(_gop_arg0)
//line cmd/v2community/delete_api_article_#id.yap:7:1
	xLog := xlog.New("")
//line cmd/v2community/delete_api_article_#id.yap:8:1
	todo := context.TODO()
//line cmd/v2community/delete_api_article_#id.yap:9:1
	id := this.Param("id")
//line cmd/v2community/delete_api_article_#id.yap:10:1
	token, err := this.Request.Cookie("token")
//line cmd/v2community/delete_api_article_#id.yap:11:1
	uid, err := this.community.ParseJwtToken(token.Value)
//line cmd/v2community/delete_api_article_#id.yap:12:1
	if err != nil {
//line cmd/v2community/delete_api_article_#id.yap:13:1
		xLog.Error("token parse error")
//line cmd/v2community/delete_api_article_#id.yap:14:1
		this.Json__1(map[string]interface{}{"code": 0, "err": err.Error()})
	}
//line cmd/v2community/delete_api_article_#id.yap:19:1
	err = this.community.DeleteArticle(todo, uid, id)
//line cmd/v2community/delete_api_article_#id.yap:20:1
	if err != nil {
//line cmd/v2community/delete_api_article_#id.yap:21:1
		this.Json__1(map[string]interface{}{"code": 0, "err": "delete failed"})
	} else {
//line cmd/v2community/delete_api_article_#id.yap:26:1
		this.Json__1(map[string]interface{}{"code": 200, "msg": "delete success"})
	}
}
func (this *delete_api_article_id) Classfname() string {
	return "delete_api_article_#id"
}

//line cmd/v2community/delete_api_media_#id.yap:6
func (this *delete_api_media_id) Main(_gop_arg0 *yap.Context) {
	this.Handler.Main(_gop_arg0)
//line cmd/v2community/delete_api_media_#id.yap:6:1
	xLog := xlog.New("")
//line cmd/v2community/delete_api_media_#id.yap:7:1
	todo := context.TODO()
//line cmd/v2community/delete_api_media_#id.yap:8:1
	id := this.Param("id")
//line cmd/v2community/delete_api_media_#id.yap:9:1
	token, err := this.Request.Cookie("token")
//line cmd/v2community/delete_api_media_#id.yap:10:1
	uid, err := this.community.ParseJwtToken(token.Value)
//line cmd/v2community/delete_api_media_#id.yap:11:1
	if err != nil {
//line cmd/v2community/delete_api_media_#id.yap:12:1
		xLog.Error("token parse error")
//line cmd/v2community/delete_api_media_#id.yap:13:1
		this.Json__1(map[string]interface{}{"code": 0, "err": err.Error()})
	}
//line cmd/v2community/delete_api_media_#id.yap:18:1
	err = this.community.DelMedia(todo, uid, id)
//line cmd/v2community/delete_api_media_#id.yap:19:1
	if err != nil {
//line cmd/v2community/delete_api_media_#id.yap:20:1
		this.Json__1(map[string]interface{}{"code": 0, "err": "delete failed"})
	} else {
//line cmd/v2community/delete_api_media_#id.yap:25:1
		this.Json__1(map[string]interface{}{"code": 200, "msg": "delete success"})
	}
}
func (this *delete_api_media_id) Classfname() string {
	return "delete_api_media_#id"
}

//line cmd/v2community/get.yap:12
func (this *get) Main(_gop_arg0 *yap.Context) {
	this.Handler.Main(_gop_arg0)
//line cmd/v2community/get.yap:12:1
	xLog := xlog.New("")
//line cmd/v2community/get.yap:13:1
	todo := context.TODO()
//line cmd/v2community/get.yap:14:1
	var user *core.User
//line cmd/v2community/get.yap:15:1
	token, err := this.Request.Cookie("token")
//line cmd/v2community/get.yap:16:1
	if err == nil {
//line cmd/v2community/get.yap:17:1
		user, _ = this.community.GetUser(token.Value)
	}
//line cmd/v2community/get.yap:21:1
	articles, next, err := this.community.ListArticle(todo, core.MarkBegin, limitConst, "", labelConst)
//line cmd/v2community/get.yap:22:1
	if err != nil {
//line cmd/v2community/get.yap:23:1
		xLog.Error("get article error:", err)
	}
//line cmd/v2community/get.yap:27:1
	if err != nil {
//line cmd/v2community/get.yap:28:1
		xLog.Error("json marshal error:", err)
	}
//line cmd/v2community/get.yap:30:1
	this.Yap__1("home", map[string]interface{}{"User": user, "Items": articles, "Next": next})
}
func (this *get) Classfname() string {
	return "get"
}

//line cmd/v2community/get_add.yap:10
func (this *get_add) Main(_gop_arg0 *yap.Context) {
	this.Handler.Main(_gop_arg0)
//line cmd/v2community/get_add.yap:10:1
	token, err := this.Request.Cookie("token")
//line cmd/v2community/get_add.yap:11:1
	if err == nil {
//line cmd/v2community/get_add.yap:12:1
		this.user, _ = this.community.GetUser(token.Value)
	}
//line cmd/v2community/get_add.yap:14:1
	this.Yap__1("edit", map[string]*core.User{"User": this.user})
}
func (this *get_add) Classfname() string {
	return "get_add"
}

//line cmd/v2community/get_api_article_#id.yap:6
func (this *get_api_article_id) Main(_gop_arg0 *yap.Context) {
	this.Handler.Main(_gop_arg0)
//line cmd/v2community/get_api_article_#id.yap:6:1
	xLog := xlog.New("")
//line cmd/v2community/get_api_article_#id.yap:7:1
	todo := context.TODO()
//line cmd/v2community/get_api_article_#id.yap:8:1
	id := this.Param("id")
//line cmd/v2community/get_api_article_#id.yap:9:1
	article, err := this.community.Article(todo, id)
//line cmd/v2community/get_api_article_#id.yap:10:1
	if err != nil {
//line cmd/v2community/get_api_article_#id.yap:11:1
		xLog.Error("get article error:", err)
//line cmd/v2community/get_api_article_#id.yap:12:1
		this.Json__1(map[string]interface{}{"code": 0, "err": "get article failed"})
	}
//line cmd/v2community/get_api_article_#id.yap:17:1
	this.Json__1(map[string]interface{}{"code": 200, "data": article})
}
func (this *get_api_article_id) Classfname() string {
	return "get_api_article_#id"
}

//line cmd/v2community/get_api_articles.yap:7
func (this *get_api_articles) Main(_gop_arg0 *yap.Context) {
	this.Handler.Main(_gop_arg0)
//line cmd/v2community/get_api_articles.yap:7:1
	xLog := xlog.New("")
//line cmd/v2community/get_api_articles.yap:8:1
	todo := context.TODO()
//line cmd/v2community/get_api_articles.yap:9:1
	from := this.Param("from")
//line cmd/v2community/get_api_articles.yap:10:1
	limit := this.Param("limit")
//line cmd/v2community/get_api_articles.yap:11:1
	searchValue := this.Param("value")
//line cmd/v2community/get_api_articles.yap:12:1
	label := this.Param("label")
//line cmd/v2community/get_api_articles.yap:14:1
	limitInt, err := strconv.Atoi(limit)
//line cmd/v2community/get_api_articles.yap:15:1
	if err != nil {
//line cmd/v2community/get_api_articles.yap:16:1
		limitInt = limitConst
	}
//line cmd/v2community/get_api_articles.yap:20:1
	articles, next, err := this.community.ListArticle(todo, from, limitInt, searchValue, label)
//line cmd/v2community/get_api_articles.yap:21:1
	if err != nil {
//line cmd/v2community/get_api_articles.yap:22:1
		xLog.Error("get article error:", err)
//line cmd/v2community/get_api_articles.yap:23:1
		this.Json__1(map[string]interface{}{"code": 0, "err": "get article failed"})
	}
//line cmd/v2community/get_api_articles.yap:28:1
	this.Json__1(map[string]interface{}{"code": 200, "items": articles, "next": next, "value": searchValue})
}
func (this *get_api_articles) Classfname() string {
	return "get_api_articles"
}

//line cmd/v2community/get_api_media_#id_url.yap:7
func (this *get_api_media_id_url) Main(_gop_arg0 *yap.Context) {
	this.Handler.Main(_gop_arg0)
//line cmd/v2community/get_api_media_#id_url.yap:7:1
	todo := context.TODO()
//line cmd/v2community/get_api_media_#id_url.yap:8:1
	id := this.Param("id")
//line cmd/v2community/get_api_media_#id_url.yap:9:1
	fileKey, err := this.community.GetMediaUrl(todo, id)
//line cmd/v2community/get_api_media_#id_url.yap:10:1
	htmlUrl := fmt.Sprintf("%s%s", this.domain, fileKey)
//line cmd/v2community/get_api_media_#id_url.yap:11:1
	if err != nil {
//line cmd/v2community/get_api_media_#id_url.yap:12:1
		this.Json__1(map[string]interface{}{"code": 500, "err": "have no html media"})
	}
//line cmd/v2community/get_api_media_#id_url.yap:17:1
	this.Json__1(map[string]interface{}{"code": 200, "url": htmlUrl})
}
func (this *get_api_media_id_url) Classfname() string {
	return "get_api_media_#id_url"
}

//line cmd/v2community/get_api_translation_#id.yap:7
func (this *get_api_translation_id) Main(_gop_arg0 *yap.Context) {
	this.Handler.Main(_gop_arg0)
//line cmd/v2community/get_api_translation_#id.yap:7:1
	xLog := xlog.New("")
//line cmd/v2community/get_api_translation_#id.yap:8:1
	todo := context.TODO()
//line cmd/v2community/get_api_translation_#id.yap:9:1
	id := this.Param("id")
//line cmd/v2community/get_api_translation_#id.yap:10:1
	article, err := this.community.GetTranslateArticle(todo, id)
//line cmd/v2community/get_api_translation_#id.yap:12:1
	if err != nil {
//line cmd/v2community/get_api_translation_#id.yap:13:1
		xLog.Info(err)
//line cmd/v2community/get_api_translation_#id.yap:14:1
		this.Json__1(map[string]int{"code": 0})
	}
//line cmd/v2community/get_api_translation_#id.yap:18:1
	this.Json__1(map[string]interface{}{"code": 200, "content": article.Content, "tags": article.Tags, "title": article.Title})
}
func (this *get_api_translation_id) Classfname() string {
	return "get_api_translation_#id"
}

//line cmd/v2community/get_api_user_acoount_unlink.yap:5
func (this *get_api_user_acoount_unlink) Main(_gop_arg0 *yap.Context) {
	this.Handler.Main(_gop_arg0)
//line cmd/v2community/get_api_user_acoount_unlink.yap:5:1
	pv := this.Param("pv")
//line cmd/v2community/get_api_user_acoount_unlink.yap:6:1
	token, err := this.Request.Cookie("token")
//line cmd/v2community/get_api_user_acoount_unlink.yap:7:1
	if err != nil {
//line cmd/v2community/get_api_user_acoount_unlink.yap:8:1
		this.Json__1(map[string]int{"code": 200})
//line cmd/v2community/get_api_user_acoount_unlink.yap:11:1
		return
	}
//line cmd/v2community/get_api_user_acoount_unlink.yap:13:1
	switch pv {
//line cmd/v2community/get_api_user_acoount_unlink.yap:14:1
	case "Twitter":
//line cmd/v2community/get_api_user_acoount_unlink.yap:15:1
	case "Facebook":
//line cmd/v2community/get_api_user_acoount_unlink.yap:16:1
	case "Github":
//line cmd/v2community/get_api_user_acoount_unlink.yap:17:1
	case "WeChat":
//line cmd/v2community/get_api_user_acoount_unlink.yap:18:1
	default:
//line cmd/v2community/get_api_user_acoount_unlink.yap:19:1
		pv = ""
	}
//line cmd/v2community/get_api_user_acoount_unlink.yap:21:1
	gac, err := gopaccountsdk.GetClient(token.Value)
//line cmd/v2community/get_api_user_acoount_unlink.yap:22:1
	if err == nil {
//line cmd/v2community/get_api_user_acoount_unlink.yap:23:1
		gac.UnLink(pv)
	}
//line cmd/v2community/get_api_user_acoount_unlink.yap:25:1
	this.Json__1(map[string]int{"code": 200})
}
func (this *get_api_user_acoount_unlink) Classfname() string {
	return "get_api_user_acoount_unlink"
}

//line cmd/v2community/get_api_user_articles_#id.yap:8
func (this *get_api_user_articles_id) Main(_gop_arg0 *yap.Context) {
	this.Handler.Main(_gop_arg0)
//line cmd/v2community/get_api_user_articles_#id.yap:8:1
	xLog := xlog.New("")
//line cmd/v2community/get_api_user_articles_#id.yap:9:1
	todo := context.TODO()
//line cmd/v2community/get_api_user_articles_#id.yap:10:1
	id := this.Param("id")
//line cmd/v2community/get_api_user_articles_#id.yap:11:1
	page := this.Param("page")
//line cmd/v2community/get_api_user_articles_#id.yap:12:1
	limit := this.Param("limit")
//line cmd/v2community/get_api_user_articles_#id.yap:14:1
	limitInt, err := strconv.Atoi(limit)
//line cmd/v2community/get_api_user_articles_#id.yap:15:1
	if err != nil {
//line cmd/v2community/get_api_user_articles_#id.yap:16:1
		limitInt = mediaLimitConst
	}
//line cmd/v2community/get_api_user_articles_#id.yap:18:1
	items, total, err := this.community.GetArticlesByUid(todo, id, page, limitInt)
//line cmd/v2community/get_api_user_articles_#id.yap:19:1
	if err != nil {
//line cmd/v2community/get_api_user_articles_#id.yap:20:1
		xLog.Error("get article list error:", err)
//line cmd/v2community/get_api_user_articles_#id.yap:21:1
		this.Json__1(map[string]interface{}{"code": 0, "err": err.Error(), "total": 0})
	}
//line cmd/v2community/get_api_user_articles_#id.yap:27:1
	this.Json__1(map[string]interface{}{"code": 200, "items": items, "total": total})
}
func (this *get_api_user_articles_id) Classfname() string {
	return "get_api_user_articles_#id"
}

//line cmd/v2community/get_api_user_get-qrcode.yap:5
func (this *get_api_user_get_qrcode) Main(_gop_arg0 *yap.Context) {
	this.Handler.Main(_gop_arg0)
//line cmd/v2community/get_api_user_get-qrcode.yap:5:1
	token, err := this.Request.Cookie("token")
//line cmd/v2community/get_api_user_get-qrcode.yap:6:1
	if err != nil {
//line cmd/v2community/get_api_user_get-qrcode.yap:7:1
		this.Json__1(map[string]int{"code": 500})
//line cmd/v2community/get_api_user_get-qrcode.yap:10:1
		return
	}
//line cmd/v2community/get_api_user_get-qrcode.yap:12:1
	gac, err := gopaccountsdk.GetClient(token.Value)
//line cmd/v2community/get_api_user_get-qrcode.yap:13:1
	if err != nil {
//line cmd/v2community/get_api_user_get-qrcode.yap:14:1
		this.Json__1(map[string]int{"code": 500})
//line cmd/v2community/get_api_user_get-qrcode.yap:17:1
		return
	}
//line cmd/v2community/get_api_user_get-qrcode.yap:19:1
	qrData, ticket, err := gac.GetProviderWeChatQRCode("provider_wechat")
//line cmd/v2community/get_api_user_get-qrcode.yap:20:1
	if err != nil {
//line cmd/v2community/get_api_user_get-qrcode.yap:21:1
		this.Json__1(map[string]int{"code": 500})
//line cmd/v2community/get_api_user_get-qrcode.yap:24:1
		return
	}
//line cmd/v2community/get_api_user_get-qrcode.yap:26:1
	this.Json__1(map[string]interface{}{"data": qrData, "data2": ticket, "code": 200})
}
func (this *get_api_user_get_qrcode) Classfname() string {
	return "get_api_user_get-qrcode"
}

//line cmd/v2community/get_api_user_medias_#id.yap:6
func (this *get_api_user_medias_id) Main(_gop_arg0 *yap.Context) {
	this.Handler.Main(_gop_arg0)
//line cmd/v2community/get_api_user_medias_#id.yap:6:1
	todo := context.TODO()
//line cmd/v2community/get_api_user_medias_#id.yap:7:1
	format := this.Param("format")
//line cmd/v2community/get_api_user_medias_#id.yap:8:1
	uid := this.Param("id")
//line cmd/v2community/get_api_user_medias_#id.yap:9:1
	page := this.Param("page")
//line cmd/v2community/get_api_user_medias_#id.yap:10:1
	limit := this.Param("limit")
//line cmd/v2community/get_api_user_medias_#id.yap:12:1
	limitInt, err := strconv.Atoi(limit)
//line cmd/v2community/get_api_user_medias_#id.yap:13:1
	if err != nil {
//line cmd/v2community/get_api_user_medias_#id.yap:14:1
		limitInt = mediaLimitConst
	}
//line cmd/v2community/get_api_user_medias_#id.yap:16:1
	pageInt, err := strconv.Atoi(page)
//line cmd/v2community/get_api_user_medias_#id.yap:17:1
	if err != nil {
//line cmd/v2community/get_api_user_medias_#id.yap:18:1
		this.Json__1(map[string]interface{}{"code": 400, "total": 0, "err": err.Error()})
	}
//line cmd/v2community/get_api_user_medias_#id.yap:24:1
	files, total, err := this.community.ListMediaByUserId(todo, uid, format, pageInt, limitInt)
//line cmd/v2community/get_api_user_medias_#id.yap:25:1
	if err != nil {
//line cmd/v2community/get_api_user_medias_#id.yap:26:1
		this.Json__1(map[string]interface{}{"code": 0, "total": total, "err": err.Error()})
	} else {
//line cmd/v2community/get_api_user_medias_#id.yap:32:1
		this.Json__1(map[string]interface{}{"code": 200, "total": total, "items": files})
	}
}
func (this *get_api_user_medias_id) Classfname() string {
	return "get_api_user_medias_#id"
}

//line cmd/v2community/get_api_users.yap:11
func (this *get_api_users) Main(_gop_arg0 *yap.Context) {
	this.Handler.Main(_gop_arg0)
//line cmd/v2community/get_api_users.yap:11:1
	xLog := xlog.New("")
//line cmd/v2community/get_api_users.yap:12:1
	token, err := this.Request.Cookie("token")
//line cmd/v2community/get_api_users.yap:13:1
	if err == nil {
//line cmd/v2community/get_api_users.yap:14:1
		casdoorUser, _ := this.community.GetUser(token.Value)
//line cmd/v2community/get_api_users.yap:15:1
		this.user = &core.User{Id: casdoorUser.Id}
	} else {
//line cmd/v2community/get_api_users.yap:19:1
		xLog.Error("get token error:", err)
//line cmd/v2community/get_api_users.yap:20:1
		this.Json__1(map[string]interface{}{"code": 0, "msg": "get token failed", "users": nil, "next": 1})
	}
//line cmd/v2community/get_api_users.yap:28:1
	from := this.Param("from")
//line cmd/v2community/get_api_users.yap:29:1
	limit := this.Param("limit")
//line cmd/v2community/get_api_users.yap:30:1
	fromInt, err := strconv.Atoi(from)
//line cmd/v2community/get_api_users.yap:31:1
	if err != nil {
//line cmd/v2community/get_api_users.yap:32:1
		fromInt = 1
	}
//line cmd/v2community/get_api_users.yap:34:1
	limitInt, err := strconv.Atoi(limit)
//line cmd/v2community/get_api_users.yap:35:1
	if err != nil {
//line cmd/v2community/get_api_users.yap:36:1
		limitInt = limitConst
	}
//line cmd/v2community/get_api_users.yap:40:1
	userAuth, err := this.community.GetUserAuthById(this.user.Id)
//line cmd/v2community/get_api_users.yap:41:1
	if err != nil {
//line cmd/v2community/get_api_users.yap:42:1
		xLog.Error("get current user auth error:", err)
	}
//line cmd/v2community/get_api_users.yap:45:1
	if !userAuth.Status {
//line cmd/v2community/get_api_users.yap:46:1
		this.Json__1(map[string]interface{}{"code": 0, "msg": "auth failed", "items": nil, "total": 10, "next": 1})
	}
//line cmd/v2community/get_api_users.yap:55:1
	users, next, err := this.community.ListPageUsers(fromInt, limitInt)
//line cmd/v2community/get_api_users.yap:56:1
	if err != nil {
//line cmd/v2community/get_api_users.yap:57:1
		xLog.Error("get users error:", err)
//line cmd/v2community/get_api_users.yap:58:1
		this.Json__1(map[string]interface{}{"code": 0, "msg": "get users failed", "items": nil, "total": 10, "next": 1})
	}
//line cmd/v2community/get_api_users.yap:67:1
	this.Json__1(map[string]interface{}{"code": 200, "msg": "ok", "items": users, "total": len(users), "next": next})
}
func (this *get_api_users) Classfname() string {
	return "get_api_users"
}

//line cmd/v2community/get_api_video_#id.yap:7
func (this *get_api_video_id) Main(_gop_arg0 *yap.Context) {
	this.Handler.Main(_gop_arg0)
//line cmd/v2community/get_api_video_#id.yap:7:1
	todo := context.TODO()
//line cmd/v2community/get_api_video_#id.yap:8:1
	id := this.Param("id")
//line cmd/v2community/get_api_video_#id.yap:9:1
	fileKey, err := this.community.GetMediaUrl(todo, id)
//line cmd/v2community/get_api_video_#id.yap:10:1
	m := make(map[string]string, 4)
//line cmd/v2community/get_api_video_#id.yap:11:1
	format, err := this.community.GetMediaType(todo, id)
//line cmd/v2community/get_api_video_#id.yap:12:1
	if err != nil {
//line cmd/v2community/get_api_video_#id.yap:13:1
		this.Json__1(map[string]interface{}{"code": 500, "err": err.Error()})
	}
//line cmd/v2community/get_api_video_#id.yap:18:1
	htmlUrl := fmt.Sprintf("%s%s", this.domain, fileKey)
//line cmd/v2community/get_api_video_#id.yap:19:1
	if err != nil {
//line cmd/v2community/get_api_video_#id.yap:20:1
		this.Json__1(map[string]interface{}{"code": 500, "err": "have no html media"})
	}
//line cmd/v2community/get_api_video_#id.yap:25:1
	m["fileKey"] = htmlUrl
//line cmd/v2community/get_api_video_#id.yap:26:1
	m["type"] = format
//line cmd/v2community/get_api_video_#id.yap:27:1
	m["subtitle"] = this.domain + id
//line cmd/v2community/get_api_video_#id.yap:28:1
	m["status"] = "0"
//line cmd/v2community/get_api_video_#id.yap:29:1
	match, _ := regexp.MatchString("^video", format)
//line cmd/v2community/get_api_video_#id.yap:30:1
	if match {
//line cmd/v2community/get_api_video_#id.yap:31:1
		subtitle, status, err := this.community.GetVideoSubtitle(todo, id)
//line cmd/v2community/get_api_video_#id.yap:32:1
		if err != nil {
//line cmd/v2community/get_api_video_#id.yap:33:1
			this.Json__1(map[string]interface{}{"code": 200, "url": m})
		}
//line cmd/v2community/get_api_video_#id.yap:38:1
		if status == "1" {
//line cmd/v2community/get_api_video_#id.yap:39:1
			m["subtitle"] = this.domain + subtitle
		}
//line cmd/v2community/get_api_video_#id.yap:41:1
		m["status"] = status
	}
//line cmd/v2community/get_api_video_#id.yap:43:1
	this.Json__1(map[string]interface{}{"code": 200, "url": m})
}
func (this *get_api_video_id) Classfname() string {
	return "get_api_video_#id"
}

// Get User Info
//
//line cmd/v2community/get_article_#id.yap:11
func (this *get_article_id) Main(_gop_arg0 *yap.Context) {
	this.Handler.Main(_gop_arg0)
//line cmd/v2community/get_article_#id.yap:12:1
	uid := ""
//line cmd/v2community/get_article_#id.yap:13:1
	xLog := xlog.New("")
//line cmd/v2community/get_article_#id.yap:14:1
	todo := context.TODO()
//line cmd/v2community/get_article_#id.yap:15:1
	token, err := this.Request.Cookie("token")
//line cmd/v2community/get_article_#id.yap:16:1
	if err == nil {
//line cmd/v2community/get_article_#id.yap:17:1
		this.user, err = this.community.GetUser(token.Value)
//line cmd/v2community/get_article_#id.yap:18:1
		if err != nil {
//line cmd/v2community/get_article_#id.yap:19:1
			xLog.Error("get user error:", err)
//line cmd/v2community/get_article_#id.yap:20:1
			return
		}
//line cmd/v2community/get_article_#id.yap:22:1
		uid = this.user.Id
	}
//line cmd/v2community/get_article_#id.yap:25:1
	id := this.Param("id")
//line cmd/v2community/get_article_#id.yap:26:1
	platform := this.Param("platform")
//line cmd/v2community/get_article_#id.yap:27:1
	ip := this.community.GetClientIP(this.Request)
//line cmd/v2community/get_article_#id.yap:28:1
	this.community.ArticleLView(todo, id, ip, uid, platform)
//line cmd/v2community/get_article_#id.yap:29:1
	article, err := this.community.Article(todo, id)
//line cmd/v2community/get_article_#id.yap:30:1
	if err != nil {
//line cmd/v2community/get_article_#id.yap:31:1
		xLog.Error("get article error:", err)
//line cmd/v2community/get_article_#id.yap:32:1
		return
	}
//line cmd/v2community/get_article_#id.yap:34:1
	likeState, err := this.community.ArticleLikeState(todo, uid, id)
//line cmd/v2community/get_article_#id.yap:35:1
	if err != nil {
//line cmd/v2community/get_article_#id.yap:36:1
		xLog.Error("article state err:", err)
//line cmd/v2community/get_article_#id.yap:37:1
		return
	}
//line cmd/v2community/get_article_#id.yap:41:1
	this.Yap__1("article", map[string]interface{}{"User": this.user, "Article": article, "LikeState": likeState})
}
func (this *get_article_id) Classfname() string {
	return "get_article_#id"
}

//line cmd/v2community/get_edit_#id.yap:12
func (this *get_edit_id) Main(_gop_arg0 *yap.Context) {
	this.Handler.Main(_gop_arg0)
//line cmd/v2community/get_edit_#id.yap:12:1
	xLog := xlog.New("")
//line cmd/v2community/get_edit_#id.yap:13:1
	todo := context.TODO()
//line cmd/v2community/get_edit_#id.yap:14:1
	token, err := this.Request.Cookie("token")
//line cmd/v2community/get_edit_#id.yap:15:1
	if err == nil {
//line cmd/v2community/get_edit_#id.yap:16:1
		this.user, _ = this.community.GetUser(token.Value)
	}
//line cmd/v2community/get_edit_#id.yap:19:1
	uid := this.user.Id
//line cmd/v2community/get_edit_#id.yap:20:1
	id := this.Param("id")
//line cmd/v2community/get_edit_#id.yap:21:1
	if id != "" {
//line cmd/v2community/get_edit_#id.yap:22:1
		editable, err := this.community.CanEditable(todo, uid, id)
//line cmd/v2community/get_edit_#id.yap:23:1
		if err != nil {
//line cmd/v2community/get_edit_#id.yap:24:1
			xLog.Error("can editable error:", err)
//line cmd/v2community/get_edit_#id.yap:25:1
			http.Redirect(this.ResponseWriter, this.Request, "/error", http.StatusTemporaryRedirect)
		}
//line cmd/v2community/get_edit_#id.yap:27:1
		if !editable {
//line cmd/v2community/get_edit_#id.yap:28:1
			xLog.Error("no permissions")
//line cmd/v2community/get_edit_#id.yap:29:1
			http.Redirect(this.ResponseWriter, this.Request, "/error", http.StatusTemporaryRedirect)
		}
//line cmd/v2community/get_edit_#id.yap:31:1
		article, err := this.community.Article(todo, id)
//line cmd/v2community/get_edit_#id.yap:32:1
		if err != nil {
//line cmd/v2community/get_edit_#id.yap:33:1
			xLog.Error("get article error:", err)
//line cmd/v2community/get_edit_#id.yap:34:1
			http.Redirect(this.ResponseWriter, this.Request, "/error", http.StatusTemporaryRedirect)
		}
//line cmd/v2community/get_edit_#id.yap:37:1
		if err != nil {
//line cmd/v2community/get_edit_#id.yap:38:1
			xLog.Error("json marshal error:", err)
//line cmd/v2community/get_edit_#id.yap:39:1
			http.Redirect(this.ResponseWriter, this.Request, "/error", http.StatusTemporaryRedirect)
		}
//line cmd/v2community/get_edit_#id.yap:41:1
		this.Yap__1("edit", map[string]interface{}{"User": this.user, "Article": article})
	}
}
func (this *get_edit_id) Classfname() string {
	return "get_edit_#id"
}

//line cmd/v2community/get_error.yap:6
func (this *get_error) Main(_gop_arg0 *yap.Context) {
	this.Handler.Main(_gop_arg0)
//line cmd/v2community/get_error.yap:6:1
	token, err := this.Request.Cookie("token")
//line cmd/v2community/get_error.yap:7:1
	if err == nil {
//line cmd/v2community/get_error.yap:8:1
		this.user, _ = this.community.GetUser(token.Value)
	}
//line cmd/v2community/get_error.yap:11:1
	this.Yap__1("4xx", map[string]*core.User{"User": this.user})
}
func (this *get_error) Classfname() string {
	return "get_error"
}

//line cmd/v2community/get_failed.yap:10
func (this *get_failed) Main(_gop_arg0 *yap.Context) {
	this.Handler.Main(_gop_arg0)
//line cmd/v2community/get_failed.yap:10:1
	token, err := this.Request.Cookie("token")
//line cmd/v2community/get_failed.yap:11:1
	if err == nil {
//line cmd/v2community/get_failed.yap:12:1
		this.user, _ = this.community.GetUser(token.Value)
	}
//line cmd/v2community/get_failed.yap:15:1
	this.Yap__1("5xx", map[string]*core.User{"User": this.user})
}
func (this *get_failed) Classfname() string {
	return "get_failed"
}

// Get URL from query string
// redirectURL := ctx.URL.Query().Get("redirect_url")
// Get current request page URL from
// Concatenate the current request page URL from refer
//
//line cmd/v2community/get_login.yap:7
func (this *get_login) Main(_gop_arg0 *yap.Context) {
	this.Handler.Main(_gop_arg0)
//line cmd/v2community/get_login.yap:11:1
	xLog := xlog.New("")
//line cmd/v2community/get_login.yap:12:1
	refererURL, err := url.Parse(this.Request.Referer())
//line cmd/v2community/get_login.yap:13:1
	if err != nil {
//line cmd/v2community/get_login.yap:14:1
		xLog.Infof("Error parsing Referer: %#v", err)
//line cmd/v2community/get_login.yap:15:1
		return
	}
//line cmd/v2community/get_login.yap:18:1
	refererPath := refererURL.Path
//line cmd/v2community/get_login.yap:19:1
	if refererURL.RawQuery != "" {
//line cmd/v2community/get_login.yap:20:1
		refererPath = fmt.Sprintf("%s?%s", refererURL.Path, refererURL.RawQuery)
	}
//line cmd/v2community/get_login.yap:23:1
	redirectURL := fmt.Sprintf("%s://%s/%s?origin_path=%s", refererURL.Scheme, refererURL.Host, "login/callback", url.QueryEscape(refererPath))
//line cmd/v2community/get_login.yap:25:1
	loginURL := this.community.RedirectToCasdoor(redirectURL)
//line cmd/v2community/get_login.yap:26:1
	this.Redirect(loginURL, http.StatusFound)
}
func (this *get_login) Classfname() string {
	return "get_login"
}

//line cmd/v2community/get_login_callback.yap:8
func (this *get_login_callback) Main(_gop_arg0 *yap.Context) {
	this.Handler.Main(_gop_arg0)
//line cmd/v2community/get_login_callback.yap:8:1
	xLog := xlog.New("")
//line cmd/v2community/get_login_callback.yap:9:1
	code := this.URL.Query().Get("code")
//line cmd/v2community/get_login_callback.yap:10:1
	state := this.URL.Query().Get("state")
//line cmd/v2community/get_login_callback.yap:11:1
	token, err := this.community.GetOAuthToken(code, state)
//line cmd/v2community/get_login_callback.yap:12:1
	if err != nil {
//line cmd/v2community/get_login_callback.yap:13:1
		xLog.Error("set token error:", err)
	}
//line cmd/v2community/get_login_callback.yap:15:1
	cookie := http.Cookie{Name: "token", Value: token.AccessToken, Path: "/", MaxAge: 168 * 60 * 60, HttpOnly: true}
//line cmd/v2community/get_login_callback.yap:22:1
	http.SetCookie(this.ResponseWriter, &cookie)
//line cmd/v2community/get_login_callback.yap:24:1
	origin_path := this.URL.Query().Get("origin_path")
//line cmd/v2community/get_login_callback.yap:25:1
	unurl, err := url.QueryUnescape(origin_path)
//line cmd/v2community/get_login_callback.yap:26:1
	if err != nil {
//line cmd/v2community/get_login_callback.yap:27:1
		xLog.Info("Unurl error", err)
//line cmd/v2community/get_login_callback.yap:28:1
		unurl = "/"
	}
//line cmd/v2community/get_login_callback.yap:31:1
	http.Redirect(this.ResponseWriter, this.Request, unurl, http.StatusFound)
}
func (this *get_login_callback) Classfname() string {
	return "get_login_callback"
}

//line cmd/v2community/get_logout.yap:8
func (this *get_logout) Main(_gop_arg0 *yap.Context) {
	this.Handler.Main(_gop_arg0)
//line cmd/v2community/get_logout.yap:8:1
	xLog := xlog.New("")
//line cmd/v2community/get_logout.yap:9:1
	tokenCookie, err := this.Request.Cookie("token")
//line cmd/v2community/get_logout.yap:10:1
	if err != nil {
//line cmd/v2community/get_logout.yap:11:1
		xLog.Error("remove token error:", err)
//line cmd/v2community/get_logout.yap:12:1
		return
	}
//line cmd/v2community/get_logout.yap:16:1
	tokenCookie.MaxAge = -1
//line cmd/v2community/get_logout.yap:17:1
	http.SetCookie(this.ResponseWriter, tokenCookie)
//line cmd/v2community/get_logout.yap:19:1
	refererURL, err := url.Parse(this.Request.Referer())
//line cmd/v2community/get_logout.yap:20:1
	if err != nil {
//line cmd/v2community/get_logout.yap:21:1
		xLog.Infof("Error parsing Referer: %#v", err)
//line cmd/v2community/get_logout.yap:22:1
		return
	}
//line cmd/v2community/get_logout.yap:25:1
	refererPath := refererURL.Path
//line cmd/v2community/get_logout.yap:26:1
	if refererURL.RawQuery != "" {
//line cmd/v2community/get_logout.yap:27:1
		refererPath = fmt.Sprintf("%s?%s", refererURL.Path, refererURL.RawQuery)
	}
//line cmd/v2community/get_logout.yap:30:1
	http.Redirect(this.ResponseWriter, this.Request, refererPath, http.StatusFound)
}
func (this *get_logout) Classfname() string {
	return "get_logout"
}

//line cmd/v2community/get_search.yap:11
func (this *get_search) Main(_gop_arg0 *yap.Context) {
	this.Handler.Main(_gop_arg0)
//line cmd/v2community/get_search.yap:11:1
	xLog := xlog.New("")
//line cmd/v2community/get_search.yap:12:1
	todo := context.TODO()
//line cmd/v2community/get_search.yap:13:1
	searchValue := this.Param("value")
//line cmd/v2community/get_search.yap:14:1
	label := this.Param("label")
//line cmd/v2community/get_search.yap:15:1
	if label == "" {
//line cmd/v2community/get_search.yap:16:1
		label = "article"
	}
//line cmd/v2community/get_search.yap:19:1
	token, err := this.Request.Cookie("token")
//line cmd/v2community/get_search.yap:20:1
	if err == nil {
//line cmd/v2community/get_search.yap:21:1
		this.user, _ = this.community.GetUser(token.Value)
	}
//line cmd/v2community/get_search.yap:24:1
	articles, next, err := this.community.ListArticle(todo, core.MarkBegin, limitConst, searchValue, label)
//line cmd/v2community/get_search.yap:25:1
	if err != nil {
//line cmd/v2community/get_search.yap:26:1
		xLog.Error("get article error:", err)
	}
//line cmd/v2community/get_search.yap:30:1
	if err != nil {
//line cmd/v2community/get_search.yap:31:1
		xLog.Error("json marshal error:", err)
	}
//line cmd/v2community/get_search.yap:33:1
	this.Yap__1("home", map[string]interface{}{"User": this.user, "Items": articles, "Value": searchValue, "Next": next, "Tab": label})
}
func (this *get_search) Classfname() string {
	return "get_search"
}

//line cmd/v2community/get_success.yap:1
func (this *get_success) Main(_gop_arg0 *yap.Context) {
	this.Handler.Main(_gop_arg0)
//line cmd/v2community/get_success.yap:1:1
	this.Yap__1("2xx", map[string]interface{}{})
}
func (this *get_success) Classfname() string {
	return "get_success"
}

//line cmd/v2community/get_user_edit.yap:12
func (this *get_user_edit) Main(_gop_arg0 *yap.Context) {
	this.Handler.Main(_gop_arg0)
//line cmd/v2community/get_user_edit.yap:12:1
	xLog := xlog.New("")
//line cmd/v2community/get_user_edit.yap:13:1
	var uid string
//line cmd/v2community/get_user_edit.yap:14:1
	token, err := this.Request.Cookie("token")
//line cmd/v2community/get_user_edit.yap:15:1
	if err == nil {
//line cmd/v2community/get_user_edit.yap:16:1
		this.user, err = this.community.GetUser(token.Value)
//line cmd/v2community/get_user_edit.yap:17:1
		if err != nil {
//line cmd/v2community/get_user_edit.yap:18:1
			xLog.Error("get user error:", err)
		}
//line cmd/v2community/get_user_edit.yap:20:1
		uid = this.user.Id
	}
//line cmd/v2community/get_user_edit.yap:22:1
	userClaim, err := this.community.GetUserClaim(uid)
//line cmd/v2community/get_user_edit.yap:23:1
	if err != nil {
//line cmd/v2community/get_user_edit.yap:24:1
		xLog.Error("get current user error:", err)
	}
//line cmd/v2community/get_user_edit.yap:26:1
	gac, err := gopaccountsdk.GetClient(token.Value)
//line cmd/v2community/get_user_edit.yap:27:1
	if err != nil {
//line cmd/v2community/get_user_edit.yap:28:1
		xLog.Info("gac", err)
//line cmd/v2community/get_user_edit.yap:29:1
		http.Redirect(this.ResponseWriter, this.Request, "/error", http.StatusTemporaryRedirect)
	}
//line cmd/v2community/get_user_edit.yap:31:1
	appInfo, err := this.community.GetApplicationInfo()
//line cmd/v2community/get_user_edit.yap:32:1
	if err != nil {
//line cmd/v2community/get_user_edit.yap:33:1
		xLog.Error("get application info error:", err)
//line cmd/v2community/get_user_edit.yap:34:1
		http.Redirect(this.ResponseWriter, this.Request, "/error", http.StatusTemporaryRedirect)
	}
//line cmd/v2community/get_user_edit.yap:36:1
	providers := gac.GetProviders()
//line cmd/v2community/get_user_edit.yap:38:1
	this.Yap__1("user_edit", map[string]interface{}{"User": this.user, "CurrentUser": userClaim, "Application": appInfo, "Binds": gac.GetProviderBindStatus(), "casdoorUrl": gopaccountsdk.GetCasdoorEndPoint(), "providers": providers})
}
func (this *get_user_edit) Classfname() string {
	return "get_user_edit"
}

//line cmd/v2community/get_user_info_#id.yap:16
func (this *get_user_info_id) Main(_gop_arg0 *yap.Context) {
	this.Handler.Main(_gop_arg0)
//line cmd/v2community/get_user_info_#id.yap:16:1
	xLog := xlog.New("")
//line cmd/v2community/get_user_info_#id.yap:17:1
	todo := context.TODO()
//line cmd/v2community/get_user_info_#id.yap:18:1
	id := this.Param("id")
//line cmd/v2community/get_user_info_#id.yap:21:1
	userClaim, err := this.community.GetUserClaim(id)
//line cmd/v2community/get_user_info_#id.yap:22:1
	if err != nil {
//line cmd/v2community/get_user_info_#id.yap:23:1
		xLog.Error("get current user error:", err)
	}
//line cmd/v2community/get_user_info_#id.yap:27:1
	token, err := this.Request.Cookie("token")
//line cmd/v2community/get_user_info_#id.yap:28:1
	if err == nil {
//line cmd/v2community/get_user_info_#id.yap:29:1
		this.user, _ = this.community.GetUser(token.Value)
	}
//line cmd/v2community/get_user_info_#id.yap:33:1
	items, total, err := this.community.GetArticlesByUid(todo, id, firstConst, mediaLimitConst)
//line cmd/v2community/get_user_info_#id.yap:34:1
	if err != nil {
//line cmd/v2community/get_user_info_#id.yap:35:1
		xLog.Error("get article list error:", err)
	}
//line cmd/v2community/get_user_info_#id.yap:39:1
	isAdmin, err := this.community.IsAdmin(id)
//line cmd/v2community/get_user_info_#id.yap:40:1
	if err != nil {
//line cmd/v2community/get_user_info_#id.yap:41:1
		xLog.Error("check admin error:", err)
	}
//line cmd/v2community/get_user_info_#id.yap:43:1
	this.Yap__1("user", map[string]interface{}{"Id": id, "CurrentUser": userClaim, "User": this.user, "Items": items, "Total": total, "IsAdmin": isAdmin})
}
func (this *get_user_info_id) Classfname() string {
	return "get_user_info_#id"
}

//line cmd/v2community/handle.yap:1
func (this *handle) Main(_gop_arg0 *yap.Context) {
	this.Handler.Main(_gop_arg0)
//line cmd/v2community/handle.yap:1:1
	this.Yap__1("4xx", map[string]interface{}{})
}
func (this *handle) Classfname() string {
	return "handle"
}

//line cmd/v2community/post_api_article_commit.yap:13
func (this *post_api_article_commit) Main(_gop_arg0 *yap.Context) {
	this.Handler.Main(_gop_arg0)
//line cmd/v2community/post_api_article_commit.yap:13:1
	xLog := xlog.New("")
//line cmd/v2community/post_api_article_commit.yap:14:1
	todo := context.TODO()
//line cmd/v2community/post_api_article_commit.yap:15:1
	id := this.Param("id")
//line cmd/v2community/post_api_article_commit.yap:16:1
	content := this.Param("content")
//line cmd/v2community/post_api_article_commit.yap:17:1
	title := this.Param("title")
//line cmd/v2community/post_api_article_commit.yap:18:1
	tags := this.Param("tags")
//line cmd/v2community/post_api_article_commit.yap:19:1
	abstract := this.Param("abstract")
//line cmd/v2community/post_api_article_commit.yap:20:1
	label := this.Param("label")
//line cmd/v2community/post_api_article_commit.yap:21:1
	trans, err := strconv.ParseBool(this.Param("trans"))
//line cmd/v2community/post_api_article_commit.yap:22:1
	if err != nil {
//line cmd/v2community/post_api_article_commit.yap:23:1
		xLog.Error("parse bool error:", err)
	}
//line cmd/v2community/post_api_article_commit.yap:27:1
	token, err := this.Request.Cookie("token")
//line cmd/v2community/post_api_article_commit.yap:28:1
	if err != nil {
//line cmd/v2community/post_api_article_commit.yap:29:1
		xLog.Info("token", err)
//line cmd/v2community/post_api_article_commit.yap:30:1
		this.Json__1(map[string]interface{}{"code": 0, "err": "no token"})
	}
//line cmd/v2community/post_api_article_commit.yap:35:1
	uid, err := this.community.ParseJwtToken(token.Value)
//line cmd/v2community/post_api_article_commit.yap:36:1
	if err != nil {
//line cmd/v2community/post_api_article_commit.yap:37:1
		xLog.Info("uid", err)
//line cmd/v2community/post_api_article_commit.yap:38:1
		this.Json__1(map[string]interface{}{"code": 0, "err": err.Error()})
	}
//line cmd/v2community/post_api_article_commit.yap:43:1
	article := &core.Article{ArticleEntry: core.ArticleEntry{ID: id, Title: title, UId: uid, Cover: this.Param("cover"), Tags: tags, Abstract: abstract, Label: label}, Content: content, Trans: trans, VttId: this.Param("vtt_id")}
//line cmd/v2community/post_api_article_commit.yap:59:1
	if trans {
//line cmd/v2community/post_api_article_commit.yap:60:1
		article, _ = this.community.TranslateArticle(todo, article)
	}
//line cmd/v2community/post_api_article_commit.yap:63:1
	id, err = this.community.PutArticle(todo, uid, article)
//line cmd/v2community/post_api_article_commit.yap:64:1
	if err != nil {
//line cmd/v2community/post_api_article_commit.yap:65:1
		xLog.Info(err)
//line cmd/v2community/post_api_article_commit.yap:66:1
		this.Json__1(map[string]interface{}{"code": 0, "err": "add failed"})
	}
//line cmd/v2community/post_api_article_commit.yap:71:1
	this.Json__1(map[string]interface{}{"code": 200, "data": id})
}
func (this *post_api_article_commit) Classfname() string {
	return "post_api_article_commit"
}

//line cmd/v2community/post_api_article_like.yap:7
func (this *post_api_article_like) Main(_gop_arg0 *yap.Context) {
	this.Handler.Main(_gop_arg0)
//line cmd/v2community/post_api_article_like.yap:7:1
	xLog := xlog.New("")
//line cmd/v2community/post_api_article_like.yap:8:1
	todo := context.TODO()
//line cmd/v2community/post_api_article_like.yap:9:1
	articleId := this.Param("articleId")
//line cmd/v2community/post_api_article_like.yap:10:1
	articleIdInt, err := strconv.Atoi(articleId)
//line cmd/v2community/post_api_article_like.yap:11:1
	if err != nil {
//line cmd/v2community/post_api_article_like.yap:12:1
		this.Json__1(map[string]interface{}{"code": 500, "err": err.Error()})
	}
//line cmd/v2community/post_api_article_like.yap:17:1
	token, err := this.Request.Cookie("token")
//line cmd/v2community/post_api_article_like.yap:18:1
	if err != nil {
//line cmd/v2community/post_api_article_like.yap:19:1
		xLog.Info("token", err)
//line cmd/v2community/post_api_article_like.yap:20:1
		this.Json__1(map[string]interface{}{"code": 0, "err": "no token"})
	}
//line cmd/v2community/post_api_article_like.yap:25:1
	uid, err := this.community.ParseJwtToken(token.Value)
//line cmd/v2community/post_api_article_like.yap:26:1
	if err != nil {
//line cmd/v2community/post_api_article_like.yap:27:1
		this.Json__1(map[string]interface{}{"code": 0, "err": err.Error()})
	}
//line cmd/v2community/post_api_article_like.yap:32:1
	res, err := this.community.ArticleLike(todo, articleIdInt, uid)
//line cmd/v2community/post_api_article_like.yap:33:1
	if err != nil {
//line cmd/v2community/post_api_article_like.yap:34:1
		this.Json__1(map[string]interface{}{"code": 500, "err": err.Error()})
	}
//line cmd/v2community/post_api_article_like.yap:39:1
	this.Json__1(map[string]interface{}{"code": 200, "data": res})
}
func (this *post_api_article_like) Classfname() string {
	return "post_api_article_like"
}

//line cmd/v2community/post_api_caption_task.yap:5
func (this *post_api_caption_task) Main(_gop_arg0 *yap.Context) {
	this.Handler.Main(_gop_arg0)
//line cmd/v2community/post_api_caption_task.yap:5:1
	todo := context.TODO()
//line cmd/v2community/post_api_caption_task.yap:6:1
	uid := this.Param("uid")
//line cmd/v2community/post_api_caption_task.yap:7:1
	vid := this.Param("vid")
//line cmd/v2community/post_api_caption_task.yap:9:1
	if uid == "" || vid == "" {
//line cmd/v2community/post_api_caption_task.yap:10:1
		this.Json__1(map[string]interface{}{"code": 200, "msg": "Invalid param"})
	}
//line cmd/v2community/post_api_caption_task.yap:16:1
	if
//line cmd/v2community/post_api_caption_task.yap:16:1
	err := this.community.RetryCaptionGenerate(todo, uid, vid); err != nil {
//line cmd/v2community/post_api_caption_task.yap:17:1
		this.Json__1(map[string]interface{}{"code": 200, "msg": "Request task error"})
	}
//line cmd/v2community/post_api_caption_task.yap:23:1
	this.Json__1(map[string]interface{}{"code": 200, "msg": "Ok"})
}
func (this *post_api_caption_task) Classfname() string {
	return "post_api_caption_task"
}

//line cmd/v2community/post_api_media.yap:10
func (this *post_api_media) Main(_gop_arg0 *yap.Context) {
	this.Handler.Main(_gop_arg0)
//line cmd/v2community/post_api_media.yap:10:1
	todo := context.TODO()
//line cmd/v2community/post_api_media.yap:11:1
	xLog := xlog.New("")
//line cmd/v2community/post_api_media.yap:12:1
	file, header, err := this.FormFile("file")
//line cmd/v2community/post_api_media.yap:13:1
	if err != nil {
//line cmd/v2community/post_api_media.yap:14:1
		xLog.Error("upload file error:", header)
//line cmd/v2community/post_api_media.yap:15:1
		this.JSON(500, err.Error())
//line cmd/v2community/post_api_media.yap:16:1
		return
	}
//line cmd/v2community/post_api_media.yap:18:1
	filename := header.Filename
//line cmd/v2community/post_api_media.yap:19:1
	err = this.ParseMultipartForm(10 << 20)
//line cmd/v2community/post_api_media.yap:20:1
	if err != nil {
//line cmd/v2community/post_api_media.yap:21:1
		xLog.Error("upload file error:", filename)
//line cmd/v2community/post_api_media.yap:22:1
		this.JSON(500, err.Error())
//line cmd/v2community/post_api_media.yap:23:1
		return
	}
//line cmd/v2community/post_api_media.yap:26:1
	dst, err := os.Create(filename)
//line cmd/v2community/post_api_media.yap:27:1
	if err != nil {
//line cmd/v2community/post_api_media.yap:28:1
		xLog.Error("create file error:", file)
//line cmd/v2community/post_api_media.yap:29:1
		this.JSON(500, err.Error())
//line cmd/v2community/post_api_media.yap:30:1
		return
	}
//line cmd/v2community/post_api_media.yap:32:1
	defer func() {
//line cmd/v2community/post_api_media.yap:33:1
		file.Close()
//line cmd/v2community/post_api_media.yap:34:1
		dst.Close()
//line cmd/v2community/post_api_media.yap:35:1
		err = os.Remove(filename)
//line cmd/v2community/post_api_media.yap:36:1
		if err != nil {
//line cmd/v2community/post_api_media.yap:37:1
			xLog.Error("delete file error:", filename)
//line cmd/v2community/post_api_media.yap:38:1
			return
		}
	}()
//line cmd/v2community/post_api_media.yap:42:1
	_, err = io.Copy(dst, file)
//line cmd/v2community/post_api_media.yap:43:1
	if err != nil {
//line cmd/v2community/post_api_media.yap:44:1
		xLog.Error("copy file errer:", filename)
//line cmd/v2community/post_api_media.yap:45:1
		this.JSON(500, err.Error())
//line cmd/v2community/post_api_media.yap:46:1
		return
	}
//line cmd/v2community/post_api_media.yap:49:1
	bytes, err := os.ReadFile(filename)
//line cmd/v2community/post_api_media.yap:50:1
	if err != nil {
//line cmd/v2community/post_api_media.yap:51:1
		xLog.Error("read file errer:", filename)
//line cmd/v2community/post_api_media.yap:52:1
		this.JSON(500, err.Error())
//line cmd/v2community/post_api_media.yap:53:1
		return
	}
//line cmd/v2community/post_api_media.yap:56:1
	token, err := this.Request.Cookie("token")
//line cmd/v2community/post_api_media.yap:57:1
	if err != nil {
//line cmd/v2community/post_api_media.yap:58:1
		this.JSON(500, err.Error())
	}
//line cmd/v2community/post_api_media.yap:61:1
	uid, err := this.community.ParseJwtToken(token.Value)
//line cmd/v2community/post_api_media.yap:62:1
	if err != nil {
//line cmd/v2community/post_api_media.yap:63:1
		this.JSON(500, err.Error())
	}
//line cmd/v2community/post_api_media.yap:65:1
	ext := mimetype.Detect(bytes).String()
//line cmd/v2community/post_api_media.yap:66:1
	id, err := this.community.SaveMedia(todo, uid, bytes, ext)
//line cmd/v2community/post_api_media.yap:67:1
	if err != nil {
//line cmd/v2community/post_api_media.yap:68:1
		xLog.Error("save file", err.Error())
//line cmd/v2community/post_api_media.yap:69:1
		this.JSON(500, err.Error())
//line cmd/v2community/post_api_media.yap:70:1
		return
	}
//line cmd/v2community/post_api_media.yap:74:1
	if strings.Contains(ext, "video") {
//line cmd/v2community/post_api_media.yap:76:1
		err := this.community.NewVideoTask(todo, uid, strconv.FormatInt(id, 10))
//line cmd/v2community/post_api_media.yap:77:1
		if err != nil {
//line cmd/v2community/post_api_media.yap:78:1
			xLog.Error("start video task error:", err)
		}
	}
//line cmd/v2community/post_api_media.yap:82:1
	this.JSON(200, id)
}
func (this *post_api_media) Classfname() string {
	return "post_api_media"
}

//line cmd/v2community/post_api_translation.yap:8
func (this *post_api_translation) Main(_gop_arg0 *yap.Context) {
	this.Handler.Main(_gop_arg0)
//line cmd/v2community/post_api_translation.yap:8:1
	todo := context.TODO()
//line cmd/v2community/post_api_translation.yap:9:1
	mdData := this.Param("content")
//line cmd/v2community/post_api_translation.yap:10:1
	transData, err := this.community.TranslateMarkdownText(todo, mdData, "auto", language.English)
//line cmd/v2community/post_api_translation.yap:11:1
	if err != nil {
//line cmd/v2community/post_api_translation.yap:12:1
		this.Json__1(map[string]interface{}{"code": 500, "err": err.Error()})
	}
//line cmd/v2community/post_api_translation.yap:17:1
	this.Json__1(map[string]interface{}{"code": 200, "data": transData})
}
func (this *post_api_translation) Classfname() string {
	return "post_api_translation"
}

//line cmd/v2community/put_api_user.yap:6
func (this *put_api_user) Main(_gop_arg0 *yap.Context) {
	this.Handler.Main(_gop_arg0)
//line cmd/v2community/put_api_user.yap:6:1
	xLog := xlog.New("")
//line cmd/v2community/put_api_user.yap:8:1
	token, err := this.Request.Cookie("token")
//line cmd/v2community/put_api_user.yap:9:1
	uid, err := this.community.ParseJwtToken(token.Value)
//line cmd/v2community/put_api_user.yap:10:1
	user := &core.UserInfo{Id: uid, Name: this.Param("name"), Birthday: this.Param("birthday"), Gender: this.Param("gender"), Phone: this.Param("phone"), Email: this.Param("email"), Avatar: this.Param("avatar"), Owner: this.Param("owner"), DisplayName: this.Param("displayName")}
//line cmd/v2community/put_api_user.yap:23:1
	_, err = this.community.UpdateUser(user)
//line cmd/v2community/put_api_user.yap:24:1
	if err != nil {
//line cmd/v2community/put_api_user.yap:25:1
		xLog.Info(err)
//line cmd/v2community/put_api_user.yap:26:1
		this.Json__1(map[string]interface{}{"code": 0, "msg": "update failed"})
	}
//line cmd/v2community/put_api_user.yap:31:1
	this.Json__1(map[string]int{"code": 200})
}
func (this *put_api_user) Classfname() string {
	return "put_api_user"
}

//line cmd/v2community/put_api_user_public.yap:11
func (this *put_api_user_public) Main(_gop_arg0 *yap.Context) {
	this.Handler.Main(_gop_arg0)
//line cmd/v2community/put_api_user_public.yap:11:1
	xLog := xlog.New("")
//line cmd/v2community/put_api_user_public.yap:12:1
	token, err := this.Request.Cookie("token")
//line cmd/v2community/put_api_user_public.yap:13:1
	if err == nil {
//line cmd/v2community/put_api_user_public.yap:14:1
		casdoorUser, _ := this.community.GetUser(token.Value)
//line cmd/v2community/put_api_user_public.yap:15:1
		this.user = &core.User{Id: casdoorUser.Id}
	} else {
//line cmd/v2community/put_api_user_public.yap:19:1
		xLog.Error("get token error:", err)
//line cmd/v2community/put_api_user_public.yap:20:1
		this.Json__1(map[string]interface{}{"code": 0, "msg": "get token failed", "users": nil, "next": 1})
	}
//line cmd/v2community/put_api_user_public.yap:29:1
	userAuth, err := this.community.GetUserAuthById(this.user.Id)
//line cmd/v2community/put_api_user_public.yap:30:1
	if err != nil {
//line cmd/v2community/put_api_user_public.yap:31:1
		xLog.Error("get current user auth error:", err)
	}
//line cmd/v2community/put_api_user_public.yap:34:1
	if !userAuth.Status {
//line cmd/v2community/put_api_user_public.yap:35:1
		this.Json__1(map[string]interface{}{"code": 0, "msg": "auth failed", "items": nil, "total": 10, "next": 1})
	}
//line cmd/v2community/put_api_user_public.yap:44:1
	uid := this.Param("uid")
//line cmd/v2community/put_api_user_public.yap:45:1
	isPublic := this.Param("is_public")
//line cmd/v2community/put_api_user_public.yap:46:1
	isPublicBool, err := strconv.ParseBool(isPublic)
//line cmd/v2community/put_api_user_public.yap:47:1
	if err != nil {
//line cmd/v2community/put_api_user_public.yap:48:1
		xLog.Error("parse bool error:", err)
//line cmd/v2community/put_api_user_public.yap:49:1
		this.Json__1(map[string]interface{}{"code": 0, "msg": "parse bool failed"})
	}
//line cmd/v2community/put_api_user_public.yap:55:1
	res, err := this.community.UpdateUserPublicAuth(uid, isPublicBool)
//line cmd/v2community/put_api_user_public.yap:56:1
	if err != nil || !res {
//line cmd/v2community/put_api_user_public.yap:57:1
		xLog.Info(err)
//line cmd/v2community/put_api_user_public.yap:58:1
		this.Json__1(map[string]interface{}{"code": 0, "msg": "update failed"})
	}
//line cmd/v2community/put_api_user_public.yap:64:1
	this.Json__1(map[string]int{"code": 200})
}
func (this *put_api_user_public) Classfname() string {
	return "put_api_user_public"
}
func main() {
	new(AppV2).Main()
}
